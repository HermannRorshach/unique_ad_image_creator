{% extends 'base.html' %}
{% load static %}

{% block title %}
{{ title }}
{% endblock title %}

{% block content %}
<style>
    body {
        /* background-image: url("{% static 'img/345469.png' %}"); */
        background-color: #f0efef;
        }
    .grey {
        background-color: #f0efef;
    }
    #up-icon {
        position: fixed;
        bottom: 60px; /* Отступ сверху */
        right: 50px; /* Отступ справа */
        z-index: 1000; /* Чтобы иконка была выше других элементов */
        display: inline-block; /* Ограничивает ширину элемента */
        width: 30px; /* Автоматическая ширина для элемента */
        height: auto;
    }
    li {
    margin-left: 25px;
    }

    li:last-child {
    margin-bottom: 30px;
    }

</style>

<div class="grey">
{% include "planner/includes/menu.html" %}
</div>


{% include "includes/decorative-header.html" %}



<div class="post index">
    {% if object.pk == 12 %}
        <a href="#today" id="up-icon">
            <img src="{% static 'icons/angles-up-solid.png' %}" alt="Стрелка вверх">
        </a>
    {% endif %}
    <div class="row">
        <div class="col-md-7 order-md-1 order-2">
            {% include "planner/includes/button-edit-up.html" %}
            <div class="post-content">
                <!-- {{ content|safe }} -->
                {% if data.not_schedule_text %}
                <div>{{ data.not_schedule_text|safe }}</div>
            {% endif %}

            {% for key, value in data.items %}
                {% if key != 'not_schedule_text' %}
                    {% if user.is_authenticated %}
                        {{ key|safe }}
                    {% endif %}
                    <div>{{ value|safe }}</div>
                {% endif %}
            {% endfor %}

            {% if not data %}
            {{ content|safe }}
            {% endif %}
            </div>
            {% include "planner/includes/button-edit-down.html" %}
        </div>
        <div class="col-md-5 order-md-2 order-1">
            {% if image %}
                <img src="{{ image.image.url }}" class="img-fluid" alt="Post Image">
            {% endif %}
        </div>
    </div>
    <footer class="text-center mt-4 footer">
        <a href="{% url 'users:login' %}">
            <img src="{% static 'img/logo-orange.png' %}" alt="logo" class="img-fluid" style="max-height: 50px; margin-left: 5px;">
        </a>
        <p class="bottom">
            Harė Krišna, Harė Krišna, Krišna Krišna, Harė Harė<br>
            Harė Rama, Harė Rama, Rama Rama, Harė Harė
        </p>
    </footer>
</div>
<br>



<script>
    document.getElementById('edit-post-btn-up').addEventListener('click', function() {
        document.getElementById('edit-form-container-up').style.display = 'block';
    });

    document.getElementById('edit-post-form-up').addEventListener('submit', function(event) {
        event.preventDefault(); // Предотвратить перезагрузку страницы
        const formData = new FormData(this);

        fetch("{% url 'planner:post-edit' object.id %}", {
            method: 'POST',
            body: formData,
            headers: {
                'X-Requested-With': 'XMLHttpRequest' // Указывает, что запрос отправлен через AJAX
            }
        })
        .then(response => {
            if (response.ok) {
                return response.json(); // Предполагаем, что сервер возвращает JSON
            }
            throw new Error('Ошибка при сохранении изменений');
        })
        .then(data => {
            // Обновляем содержимое поста
            document.querySelector('.post-content').innerHTML = data.content;
            document.getElementById('edit-form-container-up').style.display = 'none'; // Скрыть форму
        })
        .then(data => {
            // Обновляем содержимое поста
            document.querySelector('.post-content').innerHTML = data.content;

            // Дополнительно: можно обновить посты на главной странице, если нужно
            // Это может потребовать запроса к вашему API или повторного запроса к странице
        })
        .catch(error => {
            console.error(error);
        });
    });
</script>

<script>
    document.getElementById('edit-post-btn-down').addEventListener('click', function() {
        document.getElementById('edit-form-container-down').style.display = 'block';
    });

    document.getElementById('edit-post-form-down').addEventListener('submit', function(event) {
        event.preventDefault(); // Предотвратить перезагрузку страницы
        const formData = new FormData(this);

        fetch("{% url 'planner:post-edit' object.id %}", {
            method: 'POST',
            body: formData,
            headers: {
                'X-Requested-With': 'XMLHttpRequest' // Указывает, что запрос отправлен через AJAX
            }
        })
        .then(response => {
            if (response.ok) {
                return response.json(); // Предполагаем, что сервер возвращает JSON
            }
            throw new Error('Ошибка при сохранении изменений');
        })
        .then(data => {
            // Обновляем содержимое поста
            document.querySelector('.post-content').innerHTML = data.content;
            document.getElementById('edit-form-container-down').style.display = 'none'; // Скрыть форму
        })
        .then(data => {
            // Обновляем содержимое поста
            document.querySelector('.post-content').innerHTML = data.content;

            // Дополнительно: можно обновить посты на главной странице, если нужно
            // Это может потребовать запроса к вашему API или повторного запроса к странице
        })
        .catch(error => {
            console.error(error);
        });
    });
</script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
{% endblock content %}
